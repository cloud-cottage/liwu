# 腾讯云开发集成指南

## 📋 已完成的工作

### 1. 安装依赖
已安装 `@cloudbase/js-sdk` 用于连接腾讯云开发

### 2. 创建的文件
- `/src/services/cloudbase.js` - 云数据库服务配置
- `/src/context/CloudAwarenessContext.jsx` - 云数据管理 Context

### 3. 更新的文件
- `/src/App.jsx` - 添加 CloudAwarenessProvider
- `/src/pages/Record.jsx` - 使用云数据库替代本地存储
- `/src/index.css` - 添加旋转动画

## 🔧 需要在腾讯云控制台完成的配置

### 步骤 1: 配置 Web 安全域名
1. 打开腾讯云控制台: https://tcb.cloud.tencent.com/dev?envId=liwu-0gtd91eebd863ccf
2. 点击左侧菜单 **设置** → **安全配置**
3. 在 **Web 安全域名** 中添加:
   - `localhost:5173` (本地开发)
   - `127.0.0.1:5173` (本地开发备用)
   - 您的生产域名(如果有)

### 步骤 2: 创建数据库集合
1. 点击左侧菜单 **数据库**
2. 创建以下集合(Collection):

#### 集合 1: `awareness_records` (觉察记录)
字段说明:
- `_id`: 自动生成
- `userId`: String - 用户ID
- `content`: String - 觉察内容(1-6个字符)
- `timestamp`: Date - 时间戳
- `createdAt`: ServerDate - 服务器时间

权限设置:
- 所有用户可读
- 仅创建者可写

#### 其他集合(可选,用于未来功能):
- `users` - 用户信息
- `challenges` - 挑战数据
- `wealth_history` - 财富历史
- `dreams` - 梦想清单

### 步骤 3: 配置数据库权限
在每个集合的权限设置中:
```json
{
  "read": true,
  "write": "doc._openid == auth.openid"
}
```
这样可以让所有人读取,但只能修改自己的数据。

## 🚀 测试步骤

### 1. 启动开发服务器
```bash
cd /Users/kevin/git/liwu
npm run dev
```

### 2. 打开浏览器
访问 `http://localhost:5173/record`

### 3. 测试功能
- [ ] 页面加载时自动匿名登录
- [ ] 输入觉察内容并提交
- [ ] 查看"我的觉察"标签统计
- [ ] 查看"社群动态"热门标签
- [ ] 点击标签快速添加
- [ ] 点击刷新按钮同步数据

### 4. 多设备测试
- 在另一台设备(手机/iPad)上访问相同URL
- 添加觉察记录
- 在第一台设备上点击刷新,应该能看到新数据

## 🔍 调试技巧

### 查看控制台日志
打开浏览器开发者工具(F12),查看 Console 标签:
- 成功登录会显示: "匿名登录成功"
- 添加记录会显示: "添加觉察记录成功"
- 如有错误会显示详细信息

### 常见问题

**问题 1: 登录失败**
- 检查环境ID是否正确
- 检查是否添加了安全域名

**问题 2: 数据库操作失败**
- 检查集合是否已创建
- 检查权限设置是否正确

**问题 3: 跨域问题**
- 确保在腾讯云控制台添加了当前域名

## 📱 微信小程序适配

当需要适配微信小程序时,只需:
1. 使用相同的环境ID
2. 小程序会自动使用微信登录(不需要匿名登录)
3. 数据完全共享

## 🎯 下一步

完成上述配置后,您就可以:
- ✅ 在多个设备间同步觉察数据
- ✅ 看到真实的社群动态
- ✅ 为后续的 iOS/Android 应用做准备
- ✅ 为微信小程序做准备

## 💡 优化建议

1. **用户认证**: 后续可以添加微信登录、手机号登录等
2. **数据统计**: 可以在云函数中做更复杂的数据聚合
3. **实时更新**: 可以使用 CloudBase 的实时数据库功能
4. **缓存策略**: 可以添加本地缓存减少网络请求
